<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Blog my cicd lab  note - 钟鹏群的博客</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Blog my cicd lab  note";
        var mkdocs_page_input_path = "blog-my-cicd-lab--note.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> 钟鹏群的博客
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="" href="../docs">docs</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">钟鹏群的博客</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>Blog my cicd lab  note</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h4 id="deploy-gitlab">Deploy Gitlab</h4>
<p><a href='https://docs.gitlab.com/ee/install/docker.html'> Official tutorial </a></p>
<p>I choose Helm to deploy gitlab on cluster, for i'd like to have a practise on Helm.</p>
<p>Basically, i referred to this articles</p>
<p>https://www.yangpiqiulaotou.cn/2021/03/25/helm3%E5%AE%89%E8%A3%85gitlab/
https://cloud.tencent.com/developer/article/1471464
https://www.jianshu.com/p/024aa83f1dac</p>
<h3 id="prerequisite">prerequisite</h3>
<p>kubectl create ns gitlab
kubectl config set-context --current --namespace=gitlab
kubectl config get-contexts</p>
<p>helm upgrade --install gitlab gitlab-jh/gitlab \
  --version 5.6.2 \
  --timeout 600s \
  --set global.hosts.domain=example.com \
  --set global.hosts.externalIP=10.79.128.59 \
  --set certmanager-issuer.email=me@example.com</p>
<h5 id="setup-helm-and-then-helm-install-gitlab">setup Helm  and then helm install gitlab</h5>
<ul>
<li>Install Helm
https://helm.sh/docs/intro/install/</li>
</ul>
<p>Add Helm repo source, btw, what does repo source do ?</p>
<pre><code class="language-shell">helm repo add stable https://kubernetes-charts.storage.googleapis.com
helm repo add aliyun https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts
helm repo add  apphub https://apphub.aliyuncs.com/

</code></pre>
<pre><code class="language-shell">vz@vz:~$ sudo snap install helm

error: This revision of snap &quot;helm&quot; was published using classic confinement and thus may perform
       arbitrary system changes outside of the security sandbox that snaps are usually confined to,
       which may put your system at risk.

       If you understand and want to proceed repeat the command including --classic.
</code></pre>
<p>https://gitlab-docs.creationline.com/charts/installation/deployment.html</p>
<hr>

<p>Give it up temporarily</p>
<h3 id="k8s-deploy-gitlab">K8S deploy gitlab</h3>
<p>refer to https://medium.com/@SergeyNuzhdin/how-to-easily-deploy-gitlab-on-kubernetes-75f5868cea78
failed !</p>
<pre><code class="language-shell">$ kubectl create -f gitlab/redis-deployment.yml
error: resource mapping not found for name: &quot;gitlab-redis&quot; namespace: &quot;gitlab&quot; from &quot;gitlab/redis-deployment.yml&quot;: no matches for kind &quot;Deployment&quot; in version &quot;extensions/v1beta1&quot;
ensure CRDs are installed first


solution: ↓
$ k version --short
Flag --short has been deprecated, and will be removed in the future. The --short output will become the default.
Client Version: v1.25.4
Kustomize Version: v4.5.7
Server Version: v1.25.2

$ k convert
error: unknown command &quot;convert&quot; for &quot;kubectl&quot;
----
command convert has removed from kubectl since 1.22 --- https://github.com/kubernetes/website/issues/28724
- install convert https://www.cnblogs.com/varden/p/15907141.html
  - $ curl -LO https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl-convert
  - $ sudo install -o root -g root -m 0755 kubectl-convert /usr/local/bin/kubectl-convert

-- convert usage
$ kubectl-convert -f gitlab-deployment.yaml --output-version apps/v1
$ kubectl-convert -f gitlab-ingress.yaml --output-version networking.k8s.io/v1  

## todo
online kubectl convert

</code></pre>
<ul>
<li>K8S的apiVersion该用哪个
https://segmentfault.com/a/1190000017134399</li>
</ul>
<h3 id="deploy-gitlab-on-k8s-2-not-succeed">Deploy gitlab on k8s --2   (not succeed)</h3>
<p>refer to 
https://www.qikqiak.com/post/gitlab-install-on-k8s/</p>
<pre><code class="language-shell">$ kubectl get pods -n kube-ops
NAME                          READY   STATUS             RESTARTS   AGE
gitlab-6cdc798c55-tdrjx       0/1     ImagePullBackOff   0          8m3s
postgresql-77cc99bc49-s8sjq   0/1     ImagePullBackOff   0          11m
redis-594bb69b45-8ds69        0/1     ImagePullBackOff   0          134m
</code></pre>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
