<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Blog splunk investigation - 钟鹏群的博客</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Blog splunk investigation";
        var mkdocs_page_input_path = "blog-splunk-investigation.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> 钟鹏群的博客
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="" href="../docs">docs</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">钟鹏群的博客</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>Blog splunk investigation</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h3 id="setup-a-splunk-server">Setup a Splunk server</h3>
<p>Run a Splunk server container</p>
<pre><code class="language-shell">docker run --name splunk -p 8000:8000 -p 8088:8088 -d outcoldman/splunk:6.3.3
</code></pre>
<ul>
<li>startup a splunk server<ul>
<li>docker-compose.yaml</li>
</ul>
</li>
</ul>
<pre><code>version: &quot;3&quot;
services:
  splunk:
    container_name: splunk
    user: root
    image: outcoldman/splunk:6.3.3
    ports:
      - &quot;8000:8000&quot;
</code></pre>
<ul>
<li>Splunk<ul>
<li>https://www.youtube.com/watch?v=m95GiTF0zd0</li>
<li>https://www.youtube.com/watch?v=bO_-fv6e7u4</li>
<li>https://medium.com/airwalk/log-aggregation-in-kubernetes-and-transporting-logs-to-splunk-for-analysis-ad8599607372</li>
<li>https://cloud.google.com/architecture/logging-anthos-with-splunk-connect?hl=zh-cn</li>
<li>k8s logs<ul>
<li>objects</li>
<li>metrics</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>setup a splunk server:</p>
<pre><code class="language-shell">docker run --name splunk -p 8000:8000 -p 8088:8088 -d outcoldman/splunk:6.3.3


docker run --name hello --log-driver=splunk --log-opt splunk-token=AEB5A127-3AC2-447C-8E3F-D7027AFE31D1 --log-opt splunk-url=http://139.196.39.92:8088 --log-opt splunk-sourcetype=Docker rickfast/hello-oreilly


docker run --name hello --log-driver=splunk --log-opt splunk-token=A3260AEC-672D-41D2-9B64-8BAB933EA5DE --log-opt splunk-url=http://139.196.39.92:8088 --log-opt splunk-sourcetype=Docker rickfast/hello-oreilly



docker run --name hello --log-driver=splunk --log-opt splunk-token=1620a639-5064-43dc-8d81-72ae38ec639b --log-opt splunk-url=http://10.79.128.59:8088 --log-opt splunk-sourcetype=Docker rickfast/hello-oreilly

minikube start --nodes 4 --extra-config=kubeadm.ignore-preflight-errors=NumCPU --force --cpus 1

minikube start --nodes 4 --extra-config=kubeadm.ignore-preflight-errors=NumCPU --force --cpus 1 --driver=docker
</code></pre>
<ul>
<li>
<p>Splunk 可以用来分析网站是否被黑客扫描</p>
</li>
<li>
<p>vmware kube-fluentd-operator</p>
<ul>
<li>https://pkg.go.dev/github.com/vmware/kube-fluentd-operator#section-readme</li>
</ul>
</li>
</ul>
<pre><code class="language-shell">$ curl -k http://139.196.39.92:8088/services/collector/event -H &quot;Authorization: Splunk AEB5A127-3AC2-447C-8E3F-D7027AFE31D1&quot; -d '{&quot;event&quot;: &quot;hello world&quot;}'
{&quot;text&quot;:&quot;Success&quot;,&quot;code&quot;:0}
</code></pre>
<p>=============</p>
<p>splunk log success: https://www.youtube.com/watch?v=qROXrFGqWAU&amp;t=11s</p>
<p>curl https://10.79.128.59:8088/services/collector/event -H "Authorization: Splunk 1620a639-5064-43dc-8d81-72ae38ec639b" -d '{"event": "hello world"}'</p>
<p>docker built-in send log to splunk ?
https://www.w3cschool.cn/doc_docker_1_13/docker_1_13-engine-admin-logging-splunk-index.html</p>
<p>install splunk by cmd
https://www.inmotionhosting.com/support/security/install-splunk/</p>
<p>9ED0A79E-F7B8-43DC-B7A0-7B49AE7450B9</p>
<pre><code class="language-shell">root@iZuf6bpc1lt9qlf2ma9p2lZ:~# helm install anthos-splunk -f values.yaml --namespace splunk-connect https://github.com/splunk/splunk-connect-for-kubernetes/releases/download/1.4.1/splunk-connect-for-kubernetes-1.4.1.tgz

Error: INSTALLATION FAILED: Get &quot;https://github.com/splunk/splunk-connect-for-kubernetes/releases/download/1.4.1/splunk-connect-for-kubernetes-1.4.1.tgz&quot;: unexpected EOF
</code></pre>
<pre><code class="language-shell">$ kubectl create namespace splunk-connect
$ kubectl config set-context --current --namespace=splunk-connect
$ 
helm install anthos-splunk -f values.yaml --namespace splunk-connect https://github.com/splunk/splunk-connect-for-kubernetes/releases/download/1.4.1/splunk-connect-for-kubernetes-1.4.1.tgz
</code></pre>
<ul>
<li>
<p>Splunk indexer</p>
<ul>
<li>相当于一个database</li>
<li>我们查询日志的时候，要先确认筛选是哪个database。
默认index：main (如果转发过来的数据不指定索引，则会保存在默认的main索引中)</li>
</ul>
</li>
<li>
<p>source</p>
<ul>
<li>对于从文件和目录监视的数据, source的值是路径，比如 /var/log</li>
<li>基于网络的是协议和端口, 比如 UDP: 514</li>
</ul>
</li>
<li>
<p>sourcetype</p>
<ul>
<li>是其来源的数据输入的格式，sourceType决定了数据的格式化方式。选择不同的sourceType，Splunk自动识别的常见源类型列表包括NCSA组合格式HTTP Web服务器日志，标准Apache Web服务器错误日志，Cisco网络设备（包括PIX防火墙，路由器，ACS等）生成的标准syslog。查询还可以根据sourceType来筛选</li>
</ul>
</li>
<li>
<p>fluent-plugin-splunk-hec</p>
<ul>
<li>https://github.com/splunk/fluent-plugin-splunk-hec</li>
</ul>
</li>
<li>kube-fluentd-operator<ul>
<li>https://github.com/vmware/kube-fluentd-operator</li>
</ul>
</li>
</ul>
<pre><code>#0 unexpected error error_class=RestClient::SSLCertificateNotVerified error=&quot;SSL_connect returned=1 errno=0 state=error: certificate verify failed (self signed certificate in certificate chain)&quot;

solution:
https://anujarosha.medium.com/sending-logs-to-splunk-using-fluent-plugin-splunk-hec-fluentd-output-plugin-462baba53b4f
</code></pre>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
