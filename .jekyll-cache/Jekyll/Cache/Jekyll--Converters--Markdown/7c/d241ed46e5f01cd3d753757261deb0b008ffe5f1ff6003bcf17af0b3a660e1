I"Èö<p>This blog is a tutorial of how to compile <code class="language-plaintext highlighter-rouge">python 3.10.6</code> with <code class="language-plaintext highlighter-rouge">openssl 3.0.5</code> module on <code class="language-plaintext highlighter-rouge">Ubuntu 18.04</code> and <code class="language-plaintext highlighter-rouge">mac os</code>.</p>

<p>â†“ On <code class="language-plaintext highlighter-rouge">Ubuntu 18.04</code></p>

<p>Steps:</p>

<ul>
  <li><a href="#prepare">Prepare ubuntu container</a></li>
  <li><a href="#openssl">Compile openssl</a></li>
  <li><a href="#python">Compile python</a></li>
</ul>

<p>Further:</p>
<ul>
  <li><a href="#issues">Issues encountered in the process</a></li>
  <li><a href="#references">References</a></li>
</ul>

<p>â†“ On <code class="language-plaintext highlighter-rouge">Mac OS</code></p>

<p>Steps:</p>

<ul>
  <li><a href="#prepare_mac">Prepare Mac OS</a></li>
  <li><a href="#openssl">Compile openssl</a></li>
  <li><a href="#python">Compile python</a></li>
</ul>

<p>Further:</p>
<ul>
  <li><a href="#mac_references">References</a></li>
</ul>

<p>â†“ On <code class="language-plaintext highlighter-rouge">Centos5.11</code></p>

<p>Steps:</p>
<h1 id="todo">todo</h1>

<h2 id="run-ubuntu-container-and-install-required-packages"><a name="prepare">Run Ubuntu container and install required packages</a></h2>

<p>I will demo it in Ubuntu docker container.</p>

<p>So first of all, run a ubuntu container there is no python installed.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-it</span> ubuntu:bionic /bin/bash
</code></pre></div></div>

<p>As you can see, python is not installed</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python
bash: python: <span class="nb">command </span>not found

<span class="nv">$ </span>python3
bash: python3: <span class="nb">command </span>not found
</code></pre></div></div>

<p>â†“ OS info</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat</span> /etc/os-release
<span class="nv">NAME</span><span class="o">=</span><span class="s2">"Ubuntu"</span>
<span class="nv">VERSION</span><span class="o">=</span><span class="s2">"18.04.6 LTS (Bionic Beaver)"</span>
<span class="nv">ID</span><span class="o">=</span>ubuntu
<span class="nv">ID_LIKE</span><span class="o">=</span>debian
<span class="nv">PRETTY_NAME</span><span class="o">=</span><span class="s2">"Ubuntu 18.04.6 LTS"</span>
<span class="nv">VERSION_ID</span><span class="o">=</span><span class="s2">"18.04"</span>
<span class="nv">HOME_URL</span><span class="o">=</span><span class="s2">"https://www.ubuntu.com/"</span>
<span class="nv">SUPPORT_URL</span><span class="o">=</span><span class="s2">"https://help.ubuntu.com/"</span>
<span class="nv">BUG_REPORT_URL</span><span class="o">=</span><span class="s2">"https://bugs.launchpad.net/ubuntu/"</span>
<span class="nv">PRIVACY_POLICY_URL</span><span class="o">=</span><span class="s2">"https://www.ubuntu.com/legal/terms-and-policies/privacy-policy"</span>
<span class="nv">VERSION_CODENAME</span><span class="o">=</span>bionic
<span class="nv">UBUNTU_CODENAME</span><span class="o">=</span>bionic
</code></pre></div></div>

<h4 id="install-packages">Install packages</h4>

<p>Below packages are required for compilation, otherwise will raise various errors during process.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt-get update
apt-get <span class="nb">install </span>vim <span class="nt">-y</span>

<span class="nv">$ </span>vim install-pkgs.sh

<span class="c">#!/bin/sh</span>
apt-get <span class="nb">install </span>wget <span class="nt">-y</span>
apt-get <span class="nb">install </span>make <span class="nt">-y</span>
apt-get <span class="nb">install </span>perl <span class="nt">-y</span>
apt-get <span class="nb">install </span>gcc <span class="nt">-y</span>
apt-get <span class="nb">install </span>make <span class="nt">-y</span>
apt-get <span class="nb">install </span>tcl-dev <span class="nt">-y</span>
apt-get <span class="nb">install </span>tk-dev <span class="nt">-y</span>
apt-get <span class="nb">install </span>tk <span class="nt">-y</span>
apt-get <span class="nb">install </span>libffi-dev <span class="nt">-y</span>
apt-get <span class="nb">install </span>libreadline-dev <span class="nt">-y</span>
apt-get <span class="nb">install </span>readline-devel <span class="nt">-y</span>
apt-get <span class="nb">install </span>libbz2-dev <span class="nt">-y</span>
apt-get <span class="nb">install </span>python3-tk <span class="nt">-y</span>
apt-get <span class="nb">install </span>libgdbm-dev <span class="nt">-y</span>
apt-get <span class="nb">install </span>libncurses<span class="k">*</span> <span class="nt">-y</span>
apt-get <span class="nb">install </span>libgdbm-compat-dev <span class="nt">-y</span>
apt-get <span class="nb">install </span>libreadline6-dev <span class="nt">-y</span>
apt-get <span class="nb">install </span>uuid-dev <span class="nt">-y</span>
apt-get <span class="nb">install </span>lzma-dev <span class="nt">-y</span>
apt-get <span class="nb">install </span>liblzma-dev <span class="nt">-y</span>
</code></pre></div></div>

<p>Install packages</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">chmod </span>777 install-pkgs.sh
./install-pkgs.sh
</code></pre></div></div>

<h4 id="compile-sqlite-beforehand">Compile sqlite beforehand</h4>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget https://www.sqlite.org/2018/sqlite-autoconf-3240000.tar.gz
<span class="nb">tar</span> <span class="nt">-xvzf</span> sqlite-autoconf-3240000.tar.gz
<span class="nb">cd </span>sqlite-autoconf-3240000
./configure
make 
make <span class="nb">install</span>
</code></pre></div></div>

<p>if not compile sqlite, will get below issue when compile python.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
The necessary bits to build these optional modules were not found:
_sqlite3

</code></pre></div></div>

<h2 id="compile-openssl"><a name="openssl">Compile openssl<a></a></a></h2>

<h5 id="download-openssl"><a name="download_openssl">Download openssl</a></h5>

<p>Download latest openssl</p>

<p>Go to github <a href="https://github.com/openssl/openssl/tags">openssl tags</a>, select the latest openssl version.</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget https://github.com/openssl/openssl/archive/refs/tags/openssl-3.0.5.tar.gz
<span class="nb">tar</span> <span class="nt">-xvzf</span> openssl-3.0.5.tar.gz
</code></pre></div></div>

<h5 id="config">Config</h5>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> /usr/local/openssl-3.0.5

<span class="nv">$ </span>./config <span class="nt">--prefix</span><span class="o">=</span>/usr/local/openssl-3.0.5 <span class="nt">--openssldir</span><span class="o">=</span>/usr/local/openssl-3.0.5
Configuring OpenSSL version 3.0.5 <span class="k">for </span>target linux-x86_64
Using os-specific seed configuration
Created configdata.pm
Running configdata.pm
Created Makefile.in
Created Makefile
Created include/openssl/configuration.h

<span class="k">**********************************************************************</span>
<span class="k">***</span>                                                                <span class="k">***</span>
<span class="k">***</span>   OpenSSL has been successfully configured                     <span class="k">***</span>
<span class="k">***</span>                                                                <span class="k">***</span>
<span class="k">***</span>   If you encounter a problem <span class="k">while </span>building, please open an    <span class="k">***</span>
<span class="k">***</span>   issue on GitHub &lt;https://github.com/openssl/openssl/issues&gt;  <span class="k">***</span>
<span class="k">***</span>   and include the output from the following <span class="nb">command</span>:           <span class="k">***</span>
<span class="k">***</span>                                                                <span class="k">***</span>
<span class="k">***</span>       perl configdata.pm <span class="nt">--dump</span>                                <span class="k">***</span>
<span class="k">***</span>                                                                <span class="k">***</span>
<span class="k">***</span>   <span class="o">(</span>If you are new to OpenSSL, you might want to consult the    <span class="k">***</span>
<span class="k">***</span>   <span class="s1">'Troubleshooting'</span> section <span class="k">in </span>the INSTALL.md file first<span class="o">)</span>      <span class="k">***</span>
<span class="k">***</span>                                                                <span class="k">***</span>
<span class="k">**********************************************************************</span>
</code></pre></div></div>

<p>config successfully</p>

<h5 id="make--install">Make &amp; install</h5>
<p>It will take several minutes</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make

<span class="nt">------------</span> log <span class="nt">---------------</span>
...
/usr/bin/perl <span class="s2">"-I."</span> <span class="nt">-Mconfigdata</span> <span class="s2">"util/dofile.pl"</span> <span class="se">\</span>
    <span class="s2">"-oMakefile"</span> util/shlib_wrap.sh.in <span class="o">&gt;</span> <span class="s2">"util/shlib_wrap.sh"</span>
<span class="nb">chmod </span>a+x util/shlib_wrap.sh
<span class="nb">rm</span> <span class="nt">-f</span> <span class="s2">"util/wrap.pl"</span>
/usr/bin/perl <span class="s2">"-I."</span> <span class="nt">-Mconfigdata</span> <span class="s2">"util/dofile.pl"</span> <span class="se">\</span>
    <span class="s2">"-oMakefile"</span> util/wrap.pl.in <span class="o">&gt;</span> <span class="s2">"util/wrap.pl"</span>
<span class="nb">chmod </span>a+x util/wrap.pl
make[1]: Leaving directory <span class="s1">'/home/openssl-openssl-3.0.5'</span>
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make <span class="nb">install</span>

<span class="nt">-------------</span> log <span class="nt">--------------</span>
...
<span class="nb">install </span>doc/html/man7/provider-signature.html -&gt; /usr/local/openssl-3.0.5/share/doc/openssl/html/man7/provider-signature.html
<span class="nb">install </span>doc/html/man7/provider-storemgmt.html -&gt; /usr/local/openssl-3.0.5/share/doc/openssl/html/man7/provider-storemgmt.html
<span class="nb">install </span>doc/html/man7/provider.html -&gt; /usr/local/openssl-3.0.5/share/doc/openssl/html/man7/provider.html
<span class="nb">install </span>doc/html/man7/proxy-certificates.html -&gt; /usr/local/openssl-3.0.5/share/doc/openssl/html/man7/proxy-certificates.html
<span class="nb">install </span>doc/html/man7/ssl.html -&gt; /usr/local/openssl-3.0.5/share/doc/openssl/html/man7/ssl.html
<span class="nb">install </span>doc/html/man7/x509.html -&gt; /usr/local/openssl-3.0.5/share/doc/openssl/html/man7/x509.html
</code></pre></div></div>

<p>When installation done, you will find these compiled files under <code class="language-plaintext highlighter-rouge">/usr/local/openssl-3.0.5</code>, for you config it as <code class="language-plaintext highlighter-rouge">--prefix</code></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ls</span> /usr/local/openssl-3.0.5

bin  certs  ct_log_list.cnf  ct_log_list.cnf.dist  include  lib64  misc  openssl.cnf  openssl.cnf.dist  private  share
</code></pre></div></div>

<h2 id="compile-python"><a name="python">Compile Python</a></h2>

<h5 id="download-latest-python">Download latest python</h5>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget https://www.python.org/ftp/python/3.10.6/Python-3.10.6.tgz
<span class="nb">tar</span> <span class="nt">-xvzf</span> Python-3.10.6.tgz
<span class="nb">cd </span>Python-3.10.6
</code></pre></div></div>

<h5 id="edit-setup">Edit Setup</h5>

<p>edit <code class="language-plaintext highlighter-rouge">Modules/Setup</code>, some python version might be <code class="language-plaintext highlighter-rouge">Modules/Setup.dist</code>, but this version, this is <code class="language-plaintext highlighter-rouge">Modules/Setup</code></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim Modules/Setup

</code></pre></div></div>
<p>Below is what i changed, at about line 207</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>_socket socketmodule.c

<span class="c"># Socket module helper for SSL support; you must comment out the other</span>
<span class="c"># socket line above, and edit the OPENSSL variable:</span>
<span class="nv">OPENSSL</span><span class="o">=</span>/usr/local/openssl-3.0.5
<span class="c"># _ssl _ssl.c \</span>
<span class="c">#     -I$(OPENSSL)/include -L$(OPENSSL)/lib \</span>
<span class="c">#     -lssl -lcrypto</span>
<span class="c">#_hashlib _hashopenssl.c \</span>
<span class="c">#     -I$(OPENSSL)/include -L$(OPENSSL)/lib \</span>
<span class="c">#     -lcrypto</span>

<span class="c"># To statically link OpenSSL:</span>
_ssl _ssl.c <span class="se">\</span>
     <span class="nt">-I</span><span class="si">$(</span>OPENSSL<span class="si">)</span>/include <span class="nt">-L</span><span class="si">$(</span>OPENSSL<span class="si">)</span>/lib64 <span class="se">\</span>
     <span class="nt">-l</span>:libssl.a <span class="nt">-Wl</span>,--exclude-libs,libssl.a <span class="se">\</span>
     <span class="nt">-l</span>:libcrypto.a <span class="nt">-Wl</span>,--exclude-libs,libcrypto.a
_hashlib _hashopenssl.c <span class="se">\</span>
     <span class="nt">-I</span><span class="si">$(</span>OPENSSL<span class="si">)</span>/include <span class="nt">-L</span><span class="si">$(</span>OPENSSL<span class="si">)</span>/lib64 <span class="se">\</span>
     <span class="nt">-l</span>:libcrypto.a <span class="nt">-Wl</span>,--exclude-libs,libcrypto.a
</code></pre></div></div>

<h5 id="config-1">Config</h5>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">LD_RUN_PATH</span><span class="o">=</span>/usr/local/openssl-3.0.5/lib64
./configure <span class="nt">--prefix</span><span class="o">=</span>/usr/local/python-3.10.6-with-openssl-3.0.5 <span class="nt">--with-openssl</span><span class="o">=</span>/usr/local/openssl-3.0.5/ <span class="nt">--enable-shared</span>

<span class="nt">-----------</span> log <span class="nt">------------</span>
...
config.status: creating pyconfig.h
creating Modules/Setup.local
creating Makefile


If you want a release build with all stable optimizations active <span class="o">(</span>PGO, etc<span class="o">)</span>,
please run ./configure <span class="nt">--enable-optimizations</span>
</code></pre></div></div>

<h5 id="install">Install</h5>

<p>It will take several minutes</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make

<span class="nt">--------------</span> log <span class="nt">------------</span>
...
gcc <span class="nt">-pthread</span> <span class="nt">-shared</span> build/temp.linux-x86_64-3.10/home/Python-3.10.6/Modules/_sqlite/cache.o build/temp.linux-x86_64-3.10/home/Python-3.10.6/Modules/_sqlite/connection.o build/temp.linux-x86_64-3.10/home/Python-3.10.6/Modules/_sqlite/cursor.o build/temp.linux-x86_64-3.10/home/Python-3.10.6/Modules/_sqlite/microprotocols.o build/temp.linux-x86_64-3.10/home/Python-3.10.6/Modules/_sqlite/module.o build/temp.linux-x86_64-3.10/home/Python-3.10.6/Modules/_sqlite/prepare_protocol.o build/temp.linux-x86_64-3.10/home/Python-3.10.6/Modules/_sqlite/row.o build/temp.linux-x86_64-3.10/home/Python-3.10.6/Modules/_sqlite/statement.o build/temp.linux-x86_64-3.10/home/Python-3.10.6/Modules/_sqlite/util.o <span class="nt">-L</span>/usr/lib/x86_64-linux-gnu <span class="nt">-L</span>/usr/local/lib <span class="nt">-lsqlite3</span> <span class="nt">-o</span> build/lib.linux-x86_64-3.10/_sqlite3.cpython-310-x86_64-linux-gnu.so

The following modules found by detect_modules<span class="o">()</span> <span class="k">in </span>setup.py, have been
built by the Makefile instead, as configured by the Setup files:
_abc                  _hashlib              _socket
_ssl                  <span class="nb">pwd                   time

</span>running build_scripts
copying and adjusting /home/Python-3.10.6/Tools/scripts/pydoc3 -&gt; build/scripts-3.10
copying and adjusting /home/Python-3.10.6/Tools/scripts/idle3 -&gt; build/scripts-3.10
copying and adjusting /home/Python-3.10.6/Tools/scripts/2to3 -&gt; build/scripts-3.10
changing mode of build/scripts-3.10/pydoc3 from 644 to 755
changing mode of build/scripts-3.10/idle3 from 644 to 755
changing mode of build/scripts-3.10/2to3 from 644 to 755
renaming build/scripts-3.10/pydoc3 to build/scripts-3.10/pydoc3.10
renaming build/scripts-3.10/idle3 to build/scripts-3.10/idle3.10
renaming build/scripts-3.10/2to3 to build/scripts-3.10/2to3-3.10
gcc <span class="nt">-pthread</span>     <span class="nt">-Xlinker</span> <span class="nt">-export-dynamic</span> <span class="nt">-o</span> Programs/_testembed Programs/_testembed.o libpython3.10.a <span class="nt">-lcrypt</span> <span class="nt">-lpthread</span> <span class="nt">-ldl</span>  <span class="nt">-lutil</span> <span class="nt">-lm</span> <span class="nt">-L</span>/usr/local/openssl/lib64 <span class="nt">-l</span>:libssl.a <span class="nt">-Wl</span>,--exclude-libs,libssl.a <span class="nt">-l</span>:libcrypto.a <span class="nt">-Wl</span>,--exclude-libs,libcrypto.a  <span class="nt">-L</span>/usr/local/openssl/lib64 <span class="nt">-l</span>:libcrypto.a <span class="nt">-Wl</span>,--exclude-libs,libcrypto.a   <span class="nt">-lm</span>
<span class="nb">sed</span> <span class="nt">-e</span> <span class="s2">"s,@EXENAME@,/usr/local/python-3.10.6-with-openssl-3.0.5/bin/python3.10,"</span> &lt; ./Misc/python-config.in <span class="o">&gt;</span>python-config.py
<span class="nv">LC_ALL</span><span class="o">=</span>C <span class="nb">sed</span> <span class="nt">-e</span> <span class="s1">'s,\$(\([A-Za-z0-9_]*\)),\$\{\1\},g'</span> &lt; Misc/python-config.sh <span class="o">&gt;</span>python-config
</code></pre></div></div>
<p>make successfully!</p>

<p>At last, install python.</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make <span class="nb">install</span>

<span class="nt">---------------</span> log <span class="nt">--------------</span>
...
<span class="nb">rm</span> <span class="nt">-f</span> /usr/local/python-3.10.6-with-openssl-3.0.5/bin/2to3
<span class="o">(</span><span class="nb">cd</span> /usr/local/python-3.10.6-with-openssl-3.0.5/bin<span class="p">;</span> <span class="nb">ln</span> <span class="nt">-s</span> 2to3-3.10 2to3<span class="o">)</span>
<span class="k">if </span><span class="nb">test</span> <span class="s2">"x"</span> <span class="o">!=</span> <span class="s2">"x"</span> <span class="p">;</span> <span class="k">then</span> <span class="se">\</span>
	<span class="nb">rm</span> <span class="nt">-f</span> /usr/local/python-3.10.6-with-openssl-3.0.5/bin/python3-32<span class="p">;</span> <span class="se">\</span>
	<span class="o">(</span><span class="nb">cd</span> /usr/local/python-3.10.6-with-openssl-3.0.5/bin<span class="p">;</span> <span class="nb">ln</span> <span class="nt">-s</span> python3.10-32 python3-32<span class="o">)</span> <span class="se">\</span>
<span class="k">fi
if </span><span class="nb">test</span> <span class="s2">"x"</span> <span class="o">!=</span> <span class="s2">"x"</span> <span class="p">;</span> <span class="k">then</span> <span class="se">\</span>
	<span class="nb">rm</span> <span class="nt">-f</span> /usr/local/python-3.10.6-with-openssl-3.0.5/bin/python3-intel64<span class="p">;</span> <span class="se">\</span>
	<span class="o">(</span><span class="nb">cd</span> /usr/local/python-3.10.6-with-openssl-3.0.5/bin<span class="p">;</span> <span class="nb">ln</span> <span class="nt">-s</span> python3.10-intel64 python3-intel64<span class="o">)</span> <span class="se">\</span>
<span class="k">fi
</span><span class="nb">rm</span> <span class="nt">-f</span> /usr/local/python-3.10.6-with-openssl-3.0.5/share/man/man1/python3.1
<span class="o">(</span><span class="nb">cd</span> /usr/local/python-3.10.6-with-openssl-3.0.5/share/man/man1<span class="p">;</span> <span class="nb">ln</span> <span class="nt">-s</span> python3.10.1 python3.1<span class="o">)</span>
<span class="k">if </span><span class="nb">test</span> <span class="s2">"xupgrade"</span> <span class="o">!=</span> <span class="s2">"xno"</span>  <span class="p">;</span> <span class="k">then</span> <span class="se">\</span>
	<span class="k">case</span> upgrade <span class="k">in</span> <span class="se">\</span>
		upgrade<span class="p">)</span> <span class="nv">ensurepip</span><span class="o">=</span><span class="s2">"--upgrade"</span> <span class="p">;;</span> <span class="se">\</span>
		<span class="nb">install</span><span class="p">|</span><span class="k">*</span><span class="p">)</span> <span class="nv">ensurepip</span><span class="o">=</span><span class="s2">""</span> <span class="p">;;</span> <span class="se">\</span>
	<span class="k">esac</span><span class="p">;</span> <span class="se">\</span>
	 ./python <span class="nt">-E</span> <span class="nt">-m</span> ensurepip <span class="se">\</span>
		<span class="nv">$ensurepip</span> <span class="nt">--root</span><span class="o">=</span>/ <span class="p">;</span> <span class="se">\</span>
<span class="k">fi
</span>Looking <span class="k">in </span>links: /tmp/tmpetpcoecz
Processing /tmp/tmpetpcoecz/setuptools-63.2.0-py3-none-any.whl
Processing /tmp/tmpetpcoecz/pip-22.2.1-py3-none-any.whl
Installing collected packages: setuptools, pip
  WARNING: The scripts pip3 and pip3.10 are installed <span class="k">in</span> <span class="s1">'/usr/local/python-3.10.6-with-openssl-3.0.5/bin'</span> which is not on PATH.
  Consider adding this directory to PATH or, <span class="k">if </span>you prefer to suppress this warning, use <span class="nt">--no-warn-script-location</span><span class="nb">.</span>
Successfully installed pip-22.2.1 setuptools-63.2.0
WARNING: Running pip as the <span class="s1">'root'</span> user can result <span class="k">in </span>broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv
</code></pre></div></div>
<p>Though the log is not perfect, but looks like has no impact on the result.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">ls</span> /usr/local/python-3.10.6-with-openssl-3.0.5/
bin  include  lib  share
</code></pre></div></div>

<p>Validate python</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@41892223057e:~/Python-3.10.6# /usr/local/python-3.10.6-with-openssl-3.0.5/bin/python3 <span class="nt">-v</span>
/usr/local/python-3.10.6-with-openssl-3.0.5/bin/python3: error <span class="k">while </span>loading shared libraries: libpython3.10.so.1.0: cannot open shared object file: No such file or directory
</code></pre></div></div>

<p>export LD_LIBRARY_PATH</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span>/usr/local/python-3.10.6-with-openssl-3.0.5/lib/
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="c1"># /usr/local/python-3.10.6-with-openssl-3.0.5/bin/python3
</span><span class="n">Python</span> <span class="mf">3.10</span><span class="p">.</span><span class="mi">6</span> <span class="p">(</span><span class="n">main</span><span class="p">,</span> <span class="n">Oct</span>  <span class="mi">7</span> <span class="mi">2022</span><span class="p">,</span> <span class="mi">23</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">55</span><span class="p">)</span> <span class="p">[</span><span class="n">GCC</span> <span class="mf">7.5</span><span class="p">.</span><span class="mi">0</span><span class="p">]</span> <span class="n">on</span> <span class="n">linux</span>
<span class="n">Type</span> <span class="s">"help"</span><span class="p">,</span> <span class="s">"copyright"</span><span class="p">,</span> <span class="s">"credits"</span> <span class="ow">or</span> <span class="s">"license"</span> <span class="k">for</span> <span class="n">more</span> <span class="n">information</span><span class="p">.</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">ssl</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ssl</span><span class="p">.</span><span class="n">OPENSSL_VERSION</span>
<span class="s">'OpenSSL 3.0.5 5 Jul 2022'</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>
<p>Python compiled successfully!!</p>

<hr />

<h2 id="issues-encountered"><a name="issues">Issues encountered</a></h2>

<h5 id="configured-incorrectly-in-modulesetup"><span style="color:Red">Configured incorrectly in Module/Setup</span></h5>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Socket module helper for SSL support; you must comment out the other</span>
<span class="c"># socket line above, and edit the OPENSSL variable:</span>
<span class="nv">OPENSSL</span><span class="o">=</span>/usr/local/openssl-3.0.5
_ssl _ssl.c <span class="se">\</span>
     <span class="nt">-I</span><span class="si">$(</span>OPENSSL<span class="si">)</span>/include <span class="nt">-L</span><span class="si">$(</span>OPENSSL<span class="si">)</span>/lib64 <span class="se">\</span>
     <span class="nt">-lssl</span> <span class="nt">-lcrypto</span>
_hashlib _hashopenssl.c <span class="se">\</span>
     <span class="nt">-I</span><span class="si">$(</span>OPENSSL<span class="si">)</span>/include <span class="nt">-L</span><span class="si">$(</span>OPENSSL<span class="si">)</span>/lib64 <span class="se">\</span>
     <span class="nt">-lcrypto</span>

<span class="c"># To statically link OpenSSL:</span>
_ssl _ssl.c <span class="se">\</span>
     <span class="nt">-I</span><span class="si">$(</span>OPENSSL<span class="si">)</span>/include <span class="nt">-L</span><span class="si">$(</span>OPENSSL<span class="si">)</span>/lib64 <span class="se">\</span>
     <span class="nt">-l</span>:libssl.a <span class="nt">-Wl</span>,--exclude-libs,libssl.a <span class="se">\</span>
     <span class="nt">-l</span>:libcrypto.a <span class="nt">-Wl</span>,--exclude-libs,libcrypto.a
_hashlib _hashopenssl.c <span class="se">\</span>
     <span class="nt">-I</span><span class="si">$(</span>OPENSSL<span class="si">)</span>/include <span class="nt">-L</span><span class="si">$(</span>OPENSSL<span class="si">)</span>/lib64 <span class="se">\</span>
     <span class="nt">-l</span>:libcrypto.a <span class="nt">-Wl</span>,--exclude-libs,libcrypto.a
</code></pre></div></div>

<p>I guess the upper part ( line4 to line9 ) is for dynamic compiling, and lower part is for static compiling.
So if comment out them simultaneously, will cause an error ( shown as below ) when compile python.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Modules/_ssl.o: In <span class="k">function</span> <span class="sb">`</span>PyInit__ssl<span class="s1">':
/home/Python-3.10.6/./Modules/_ssl.c:6242: multiple definition of `PyInit__ssl'</span>
Modules/_ssl.o:/home/Python-3.10.6/./Modules/_ssl.c:6242: first defined here
Modules/_hashopenssl.o:/home/Python-3.10.6/./Modules/_hashopenssl.c:1822: multiple definition of <span class="sb">`</span>HMACtype_spec<span class="s1">'
Modules/_hashopenssl.o:/home/Python-3.10.6/./Modules/_hashopenssl.c:1822: first defined here
Modules/_hashopenssl.o: In function `PyInit__hashlib'</span>:
/home/Python-3.10.6/./Modules/_hashopenssl.c:2286: multiple definition of <span class="sb">`</span>PyInit__hashlib<span class="s1">'
Modules/_hashopenssl.o:/home/Python-3.10.6/./Modules/_hashopenssl.c:2286: first defined here
collect2: error: ld returned 1 exit status
ln: failed to access '</span>libpython3.10.so.1.0<span class="s1">': No such file or directory
Makefile:656: recipe for target '</span>libpython3.10.so<span class="s1">' failed
make: *** [libpython3.10.so] Error 1
</span></code></pre></div></div>

<p>PS:</p>

<p>If you encounter other issues, itâ€™s very likely due to you not install the packages ( listed in step 1 ) properly.</p>

<p>e.g. below issue is because <code class="language-plaintext highlighter-rouge">gcc</code> is not installed.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./config <span class="nt">--prefix</span><span class="o">=</span>/usr/local/openssl <span class="nt">--openssldir</span><span class="o">=</span>/usr/local/openssl

Failure!  build file wasn<span class="s1">'t produced.
Please read INSTALL.md and associated NOTES-* files.  You may also have to
look over your available compiler tool chain or change your configuration.

ERROR!
No C compiler found, please specify one with the environment variable CC,
or configure with an explicit configuration target.
</span></code></pre></div></div>

<p>For there are so many similar issues during my compilation, i not paste them here one by one, i resolved them by installing step 1 packages.</p>

<h2 id="references"><a name="references">References</a></h2>

<ul>
  <li><a href="https://techglimpse.com/install-python-openssl-support-tutorial/">https://techglimpse.com/install-python-openssl-support-tutorial/</a></li>
  <li><a href="http://blog.lujianxin.com/x/art/s538bgptom7o">http://blog.lujianxin.com/x/art/s538bgptom7o</a></li>
</ul>

<hr />

<hr />

<p>Compile on Mac.</p>

<h2 id="preparation"><a name="prepare_mac">Preparation</a></h2>
<h5 id="check-your-architecture-of-your-mac">Check your architecture of your Mac</h5>

<p>Here is mine.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">set</span> | <span class="nb">grep</span> <span class="s2">"MACHTYPE"</span>
<span class="nv">MACHTYPE</span><span class="o">=</span>x86_64-apple-darwin20
</code></pre></div></div>

<h5 id="download-openssl-tar-ball">Download openssl tar ball.</h5>

<p>Itâ€™s same as <a href="#download_openssl">above process</a></p>

<h5 id="configure">Configure</h5>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./configure <span class="nt">--prefix</span><span class="o">=</span>/Users/vzhong/Documents/compile-target/python-3.10.6 <span class="nt">--with-openssl</span><span class="o">=</span>/Users/vzhong/Documents/compile-target/openssl-3.0.5 <span class="nt">--enable-optimizations</span> <span class="nt">--enable-shared</span>

Configuring OpenSSL version 3.0.5 <span class="k">for </span>target darwin64-x86_64-cc
Using os-specific seed configuration
Created configdata.pm
Running configdata.pm
Created Makefile.in
Created Makefile

<span class="k">**********************************************************************</span>
<span class="k">***</span>                                                                <span class="k">***</span>
<span class="k">***</span>   OpenSSL has been successfully configured                     <span class="k">***</span>
<span class="k">***</span>                                                                <span class="k">***</span>
<span class="k">***</span>   If you encounter a problem <span class="k">while </span>building, please open an    <span class="k">***</span>
<span class="k">***</span>   issue on GitHub &lt;https://github.com/openssl/openssl/issues&gt;  <span class="k">***</span>
<span class="k">***</span>   and include the output from the following <span class="nb">command</span>:           <span class="k">***</span>
<span class="k">***</span>                                                                <span class="k">***</span>
<span class="k">***</span>       perl configdata.pm <span class="nt">--dump</span>                                <span class="k">***</span>
<span class="k">***</span>                                                                <span class="k">***</span>
<span class="k">***</span>   <span class="o">(</span>If you are new to OpenSSL, you might want to consult the    <span class="k">***</span>
<span class="k">***</span>   <span class="s1">'Troubleshooting'</span> section <span class="k">in </span>the INSTALL.md file first<span class="o">)</span>      <span class="k">***</span>
<span class="k">***</span>                                                                <span class="k">***</span>
<span class="k">**********************************************************************</span>
</code></pre></div></div>

<h5 id="make--install-1">Make &amp; Install</h5>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>make

<span class="nt">----------</span> log <span class="nt">------------</span>
...
The necessary bits to build these optional modules were not found:
ossaudiodev           spwd
To find the necessary bits, look <span class="k">in </span>setup.py <span class="k">in </span>detect_modules<span class="o">()</span> <span class="k">for </span>the module<span class="s1">'s name.


The following modules found by detect_modules() in setup.py, have been
built by the Makefile instead, as configured by the Setup files:
_abc                  pwd                   time

running build_scripts
copying and adjusting /Users/vzhong/Documents/mac-compile/Python-3.10.6/Tools/scripts/pydoc3 -&gt; build/scripts-3.10
copying and adjusting /Users/vzhong/Documents/mac-compile/Python-3.10.6/Tools/scripts/idle3 -&gt; build/scripts-3.10
copying and adjusting /Users/vzhong/Documents/mac-compile/Python-3.10.6/Tools/scripts/2to3 -&gt; build/scripts-3.10
changing mode of build/scripts-3.10/pydoc3 from 644 to 755
changing mode of build/scripts-3.10/idle3 from 644 to 755
changing mode of build/scripts-3.10/2to3 from 644 to 755
renaming build/scripts-3.10/pydoc3 to build/scripts-3.10/pydoc3.10
renaming build/scripts-3.10/idle3 to build/scripts-3.10/idle3.10
renaming build/scripts-3.10/2to3 to build/scripts-3.10/2to3-3.10
gcc -c -Wno-unused-result -Wsign-compare -Wunreachable-code -DNDEBUG -g -fwrapv -O3 -Wall    -fno-semantic-interposition -std=c99 -Wextra -Wno-unused-result -Wno-unused-parameter -Wno-missing-field-initializers -Wstrict-prototypes -Werror=implicit-function-declaration -fvisibility=hidden -fprofile-instr-use=code.profclangd -I./Include/internal  -I. -I./Include    -DPy_BUILD_CORE -o Programs/_testembed.o ./Programs/_testembed.c
clang: warning: argument unused during compilation: '</span><span class="nt">-fno-semantic-interposition</span><span class="s1">' [-Wunused-command-line-argument]
gcc   -fno-semantic-interposition  -Wl,-stack_size,1000000  -framework CoreFoundation -o Programs/_testembed Programs/_testembed.o libpython3.10.a -lintl -ldl   -framework CoreFoundation

</span></code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>make <span class="nb">install</span>

<span class="nt">----------</span> log <span class="nt">------------</span>
...
<span class="k">if </span><span class="nb">test</span> <span class="s2">"xupgrade"</span> <span class="o">!=</span> <span class="s2">"xno"</span>  <span class="p">;</span> <span class="k">then</span> <span class="se">\</span>
		<span class="k">case</span> upgrade <span class="k">in</span> <span class="se">\</span>
			upgrade<span class="p">)</span> <span class="nv">ensurepip</span><span class="o">=</span><span class="s2">"--upgrade"</span> <span class="p">;;</span> <span class="se">\</span>
			<span class="nb">install</span><span class="p">|</span><span class="k">*</span><span class="p">)</span> <span class="nv">ensurepip</span><span class="o">=</span><span class="s2">""</span> <span class="p">;;</span> <span class="se">\</span>
		<span class="k">esac</span><span class="p">;</span> <span class="se">\</span>
		<span class="nv">DYLD_LIBRARY_PATH</span><span class="o">=</span>/Users/vzhong/Documents/mac-compile/Python-3.10.6 ./python.exe <span class="nt">-E</span> <span class="nt">-m</span> ensurepip <span class="se">\</span>
			<span class="nv">$ensurepip</span> <span class="nt">--root</span><span class="o">=</span>/ <span class="p">;</span> <span class="se">\</span>
	<span class="k">fi
</span>Looking <span class="k">in </span>links: /var/folders/x3/qp_d__rn70x5hml9z4ygtvv80000gr/T/tmpp4r0himi
Requirement already satisfied: setuptools <span class="k">in</span> /Users/vzhong/Documents/compile-target/python-3.10.6/lib/python3.10/site-packages <span class="o">(</span>63.2.0<span class="o">)</span>
Requirement already satisfied: pip <span class="k">in</span> /Users/vzhong/Documents/compile-target/python-3.10.6/lib/python3.10/site-packages <span class="o">(</span>22.2.1<span class="o">)</span>
</code></pre></div></div>

<p>Validate if the compilation is successful.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">$</span> <span class="o">~/</span><span class="n">Documents</span><span class="o">/</span><span class="nb">compile</span><span class="o">-</span><span class="n">target</span><span class="o">/</span><span class="n">python</span><span class="o">-</span><span class="mf">3.10</span><span class="p">.</span><span class="mi">6</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">python3</span>
<span class="n">Python</span> <span class="mf">3.10</span><span class="p">.</span><span class="mi">6</span> <span class="p">(</span><span class="n">main</span><span class="p">,</span> <span class="n">Oct</span> <span class="mi">10</span> <span class="mi">2022</span><span class="p">,</span> <span class="mi">15</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mi">10</span><span class="p">)</span> <span class="p">[</span><span class="n">Clang</span> <span class="mf">13.0</span><span class="p">.</span><span class="mi">0</span> <span class="p">(</span><span class="n">clang</span><span class="o">-</span><span class="mf">1300.0</span><span class="p">.</span><span class="mf">29.30</span><span class="p">)]</span> <span class="n">on</span> <span class="n">darwin</span>
<span class="n">Type</span> <span class="s">"help"</span><span class="p">,</span> <span class="s">"copyright"</span><span class="p">,</span> <span class="s">"credits"</span> <span class="ow">or</span> <span class="s">"license"</span> <span class="k">for</span> <span class="n">more</span> <span class="n">information</span><span class="p">.</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">ssl</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ssl</span><span class="p">.</span><span class="n">OPENSSL_VERSION</span>
<span class="s">'OpenSSL 3.0.5 5 Jul 2022'</span>
</code></pre></div></div>

<p>Ok, succeed!</p>

<h2 id="references-1"><a name="mac_references">References</a></h2>

<ul>
  <li><a href="https://www.youtube.com/watch?v=15zJ0acT4NQ">[ Youtube ] Compile Python 3.7 on macOS from scratch</a></li>
</ul>

<p>The end, hope it helps!</p>

<hr />

<h2 id="centos-511">CentOS 5.11</h2>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sh-3.2# <span class="nb">head</span> <span class="nt">-n</span> 1 /etc/issue
CentOS release 5.11 <span class="o">(</span>Final<span class="o">)</span>
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sh-3.2# yum update
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
YumRepo Error: All mirror URLs are not using ftp, http[s] or file.
 Eg. Invalid release/repo/arch combination/
removing mirrorlist with no valid mirrors: /var/cache/yum/base/mirrorlist.txt
Error: Cannot find a valid baseurl <span class="k">for </span>repo: base
</code></pre></div></div>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sh-3.2# yum <span class="nb">install </span>vim-enhanced <span class="nt">-y</span> 
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
YumRepo Error: All mirror URLs are not using ftp, http[s] or file.
 Eg. Invalid release/repo/arch combination/
removing mirrorlist with no valid mirrors: /var/cache/yum/base/mirrorlist.txt
Error: Cannot find a valid baseurl <span class="k">for </span>repo: base
sh-3.2# 
</code></pre></div></div>
<p>solution â†“</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cp</span> /etc/yum/pluginconf.d/fastestmirror.conf /etc/yum/pluginconf.d/fastestmirror.conf.bak
<span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"s|enabled=1|enabled=0|g"</span> /etc/yum/pluginconf.d/fastestmirror.conf


<span class="nb">cp</span> /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak

<span class="nb">echo</span> <span class="s1">''</span> <span class="o">&gt;</span> /etc/yum.repos.d/CentOS-Base.repo

vi /etc/yum.repos.d/CentOS-Base.repo

<span class="c"># CentOS-Base.repo</span>
<span class="c">#</span>
<span class="c"># The mirror system uses the connecting IP address of the client and the</span>
<span class="c"># update status of each mirror to pick mirrors that are updated to and</span>
<span class="c"># geographically close to the client.  You should use this for CentOS updates</span>
<span class="c"># unless you are manually picking other mirrors.</span>
<span class="c">#</span>
<span class="c"># If the mirrorlist= does not work for you, as a fall back you can try the</span>
<span class="c"># remarked out baseurl= line instead.</span>
<span class="c">#</span>
<span class="c">#</span>

<span class="o">[</span>base]
<span class="nv">name</span><span class="o">=</span>CentOS-<span class="nv">$releasever</span> - Base
<span class="c">#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=os&amp;infra=$infra</span>
<span class="c">#baseurl=http://mirror.centos.org/centos/$releasever/os/$basearch/</span>
<span class="nv">baseurl</span><span class="o">=</span>https://vault.centos.org/6.10/os/<span class="nv">$basearch</span>/
<span class="nv">gpgcheck</span><span class="o">=</span>1
<span class="nv">gpgkey</span><span class="o">=</span>file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6

<span class="c">#released updates</span>
<span class="o">[</span>updates]
<span class="nv">name</span><span class="o">=</span>CentOS-<span class="nv">$releasever</span> - Updates
<span class="c">#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=updates&amp;infra=$infra</span>
<span class="c">#baseurl=http://mirror.centos.org/centos/$releasever/updates/$basearch/</span>
<span class="nv">baseurl</span><span class="o">=</span>https://vault.centos.org/6.10/updates/<span class="nv">$basearch</span>/
<span class="nv">gpgcheck</span><span class="o">=</span>1
<span class="nv">gpgkey</span><span class="o">=</span>file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6

<span class="c">#additional packages that may be useful</span>
<span class="o">[</span>extras]
<span class="nv">name</span><span class="o">=</span>CentOS-<span class="nv">$releasever</span> - Extras
<span class="c">#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=extras&amp;infra=$infra</span>
<span class="c">#baseurl=http://mirror.centos.org/centos/$releasever/extras/$basearch/</span>
<span class="nv">baseurl</span><span class="o">=</span>https://vault.centos.org/6.10/extras/<span class="nv">$basearch</span>/
<span class="nv">gpgcheck</span><span class="o">=</span>1
<span class="nv">gpgkey</span><span class="o">=</span>file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-6
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sh-3.2# yum update

Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">"/usr/bin/yum"</span>, line 29, <span class="k">in</span> ?
    yummain.user_main<span class="o">(</span>sys.argv[1:], <span class="nv">exit_code</span><span class="o">=</span>True<span class="o">)</span>
  File <span class="s2">"/usr/share/yum-cli/yummain.py"</span>, line 309, <span class="k">in </span>user_main
    errcode <span class="o">=</span> main<span class="o">(</span>args<span class="o">)</span>
  File <span class="s2">"/usr/share/yum-cli/yummain.py"</span>, line 178, <span class="k">in </span>main
    result, resultmsgs <span class="o">=</span> base.doCommands<span class="o">()</span>
  File <span class="s2">"/usr/share/yum-cli/cli.py"</span>, line 345, <span class="k">in </span>doCommands
    self._getTs<span class="o">(</span>needTsRemove<span class="o">)</span>
  File <span class="s2">"/usr/lib/python2.4/site-packages/yum/depsolve.py"</span>, line 101, <span class="k">in </span>_getTs
    self._getTsInfo<span class="o">(</span>remove_only<span class="o">)</span>
  File <span class="s2">"/usr/lib/python2.4/site-packages/yum/depsolve.py"</span>, line 112, <span class="k">in </span>_getTsInfo
    pkgSack <span class="o">=</span> self.pkgSack
  File <span class="s2">"/usr/lib/python2.4/site-packages/yum/__init__.py"</span>, line 662, <span class="k">in</span> &lt;lambda&gt;
    pkgSack <span class="o">=</span> property<span class="o">(</span><span class="nv">fget</span><span class="o">=</span>lambda self: self._getSacks<span class="o">()</span>,
  File <span class="s2">"/usr/lib/python2.4/site-packages/yum/__init__.py"</span>, line 502, <span class="k">in </span>_getSacks
    self.repos.populateSack<span class="o">(</span><span class="nv">which</span><span class="o">=</span>repos<span class="o">)</span>
  File <span class="s2">"/usr/lib/python2.4/site-packages/yum/repos.py"</span>, line 260, <span class="k">in </span>populateSack
    sack.populate<span class="o">(</span>repo, mdtype, callback, cacheonly<span class="o">)</span>
  File <span class="s2">"/usr/lib/python2.4/site-packages/yum/yumRepo.py"</span>, line 168, <span class="k">in </span>populate
    <span class="k">if </span>self._check_db_version<span class="o">(</span>repo, mydbtype<span class="o">)</span>:
  File <span class="s2">"/usr/lib/python2.4/site-packages/yum/yumRepo.py"</span>, line 226, <span class="k">in </span>_check_db_version
    <span class="k">return </span>repo._check_db_version<span class="o">(</span>mdtype<span class="o">)</span>
  File <span class="s2">"/usr/lib/python2.4/site-packages/yum/yumRepo.py"</span>, line 1226, <span class="k">in </span>_check_db_version
    repoXML <span class="o">=</span> self.repoXML
  File <span class="s2">"/usr/lib/python2.4/site-packages/yum/yumRepo.py"</span>, line 1399, <span class="k">in</span> &lt;lambda&gt;
    repoXML <span class="o">=</span> property<span class="o">(</span><span class="nv">fget</span><span class="o">=</span>lambda self: self._getRepoXML<span class="o">()</span>,
  File <span class="s2">"/usr/lib/python2.4/site-packages/yum/yumRepo.py"</span>, line 1391, <span class="k">in </span>_getRepoXML
    self._loadRepoXML<span class="o">(</span><span class="nv">text</span><span class="o">=</span>self<span class="o">)</span>
  File <span class="s2">"/usr/lib/python2.4/site-packages/yum/yumRepo.py"</span>, line 1381, <span class="k">in </span>_loadRepoXML
    <span class="k">return </span>self._groupLoadRepoXML<span class="o">(</span>text, <span class="o">[</span><span class="s2">"primary"</span><span class="o">])</span>
  File <span class="s2">"/usr/lib/python2.4/site-packages/yum/yumRepo.py"</span>, line 1365, <span class="k">in </span>_groupLoadRepoXML
    <span class="k">if </span>self._commonLoadRepoXML<span class="o">(</span>text<span class="o">)</span>:
  File <span class="s2">"/usr/lib/python2.4/site-packages/yum/yumRepo.py"</span>, line 1201, <span class="k">in </span>_commonLoadRepoXML
    result <span class="o">=</span> self._getFileRepoXML<span class="o">(</span><span class="nb">local</span>, text<span class="o">)</span>
  File <span class="s2">"/usr/lib/python2.4/site-packages/yum/yumRepo.py"</span>, line 974, <span class="k">in </span>_getFileRepoXML
    <span class="nv">cache</span><span class="o">=</span>self.http_caching <span class="o">==</span> <span class="s1">'all'</span><span class="o">)</span>
  File <span class="s2">"/usr/lib/python2.4/site-packages/yum/yumRepo.py"</span>, line 811, <span class="k">in </span>_getFile
    <span class="nv">http_headers</span><span class="o">=</span>headers,
  File <span class="s2">"/usr/lib/python2.4/site-packages/urlgrabber/mirror.py"</span>, line 412, <span class="k">in </span>urlgrab
    <span class="k">return </span>self._mirror_try<span class="o">(</span>func, url, kw<span class="o">)</span>
  File <span class="s2">"/usr/lib/python2.4/site-packages/urlgrabber/mirror.py"</span>, line 398, <span class="k">in </span>_mirror_try
    <span class="k">return </span>func_ref<span class="o">(</span> <span class="k">*</span><span class="o">(</span>fullurl,<span class="o">)</span>, <span class="k">**</span>kwargs <span class="o">)</span>
  File <span class="s2">"/usr/lib/python2.4/site-packages/urlgrabber/grabber.py"</span>, line 936, <span class="k">in </span>urlgrab
    <span class="k">return </span>self._retry<span class="o">(</span>opts, retryfunc, url, filename<span class="o">)</span>
  File <span class="s2">"/usr/lib/python2.4/site-packages/urlgrabber/grabber.py"</span>, line 854, <span class="k">in </span>_retry
    r <span class="o">=</span> apply<span class="o">(</span>func, <span class="o">(</span>opts,<span class="o">)</span> + args, <span class="o">{})</span>
  File <span class="s2">"/usr/lib/python2.4/site-packages/urlgrabber/grabber.py"</span>, line 922, <span class="k">in </span>retryfunc
    fo <span class="o">=</span> URLGrabberFileObject<span class="o">(</span>url, filename, opts<span class="o">)</span>
  File <span class="s2">"/usr/lib/python2.4/site-packages/urlgrabber/grabber.py"</span>, line 1010, <span class="k">in </span>__init__
    self._do_open<span class="o">()</span>
  File <span class="s2">"/usr/lib/python2.4/site-packages/urlgrabber/grabber.py"</span>, line 1093, <span class="k">in </span>_do_open
    fo, hdr <span class="o">=</span> self._make_request<span class="o">(</span>req, opener<span class="o">)</span>
  File <span class="s2">"/usr/lib/python2.4/site-packages/urlgrabber/grabber.py"</span>, line 1202, <span class="k">in </span>_make_request
    fo <span class="o">=</span> opener.open<span class="o">(</span>req<span class="o">)</span>
  File <span class="s2">"/usr/lib64/python2.4/urllib2.py"</span>, line 364, <span class="k">in </span>open
    response <span class="o">=</span> meth<span class="o">(</span>req, response<span class="o">)</span>
  File <span class="s2">"/usr/lib64/python2.4/urllib2.py"</span>, line 471, <span class="k">in </span>http_response
    response <span class="o">=</span> self.parent.error<span class="o">(</span>
  File <span class="s2">"/usr/lib64/python2.4/urllib2.py"</span>, line 396, <span class="k">in </span>error
    result <span class="o">=</span> self._call_chain<span class="o">(</span><span class="k">*</span>args<span class="o">)</span>
  File <span class="s2">"/usr/lib64/python2.4/urllib2.py"</span>, line 337, <span class="k">in </span>_call_chain
    result <span class="o">=</span> func<span class="o">(</span><span class="k">*</span>args<span class="o">)</span>
  File <span class="s2">"/usr/lib64/python2.4/urllib2.py"</span>, line 565, <span class="k">in </span>http_error_302
    <span class="k">return </span>self.parent.open<span class="o">(</span>new<span class="o">)</span>
  File <span class="s2">"/usr/lib64/python2.4/urllib2.py"</span>, line 358, <span class="k">in </span>open
    response <span class="o">=</span> self._open<span class="o">(</span>req, data<span class="o">)</span>
  File <span class="s2">"/usr/lib64/python2.4/urllib2.py"</span>, line 376, <span class="k">in </span>_open
    <span class="s1">'_open'</span>, req<span class="o">)</span>
  File <span class="s2">"/usr/lib64/python2.4/urllib2.py"</span>, line 337, <span class="k">in </span>_call_chain
    result <span class="o">=</span> func<span class="o">(</span><span class="k">*</span>args<span class="o">)</span>
  File <span class="s2">"/usr/lib64/python2.4/site-packages/M2Crypto/m2urllib2.py"</span>, line 82, <span class="k">in </span>https_open
    h.request<span class="o">(</span>req.get_method<span class="o">()</span>, req.get_selector<span class="o">()</span>, req.data, headers<span class="o">)</span>
  File <span class="s2">"/usr/lib64/python2.4/httplib.py"</span>, line 810, <span class="k">in </span>request
    self._send_request<span class="o">(</span>method, url, body, headers<span class="o">)</span>
  File <span class="s2">"/usr/lib64/python2.4/httplib.py"</span>, line 833, <span class="k">in </span>_send_request
    self.endheaders<span class="o">()</span>
  File <span class="s2">"/usr/lib64/python2.4/httplib.py"</span>, line 804, <span class="k">in </span>endheaders
    self._send_output<span class="o">()</span>
  File <span class="s2">"/usr/lib64/python2.4/httplib.py"</span>, line 685, <span class="k">in </span>_send_output
    self.send<span class="o">(</span>msg<span class="o">)</span>
  File <span class="s2">"/usr/lib64/python2.4/httplib.py"</span>, line 652, <span class="k">in </span>send
    self.connect<span class="o">()</span>
  File <span class="s2">"/usr/lib64/python2.4/site-packages/M2Crypto/httpslib.py"</span>, line 55, <span class="k">in </span>connect
    sock.connect<span class="o">((</span>self.host, self.port<span class="o">))</span>
  File <span class="s2">"/usr/lib64/python2.4/site-packages/M2Crypto/SSL/Connection.py"</span>, line 174, <span class="k">in </span>connect
    ret <span class="o">=</span> self.connect_ssl<span class="o">()</span>
  File <span class="s2">"/usr/lib64/python2.4/site-packages/M2Crypto/SSL/Connection.py"</span>, line 167, <span class="k">in </span>connect_ssl
    <span class="k">return </span>m2.ssl_connect<span class="o">(</span>self.ssl, self._timeout<span class="o">)</span>
M2Crypto.SSL.SSLError: unknown protocol
</code></pre></div></div>
<p>solution
https://www.modb.pro/db/451337</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># yum update</span>
C5.8-base                                                                                         | 1.1 kB     00:00     
C5.8-base/primary                                                                                 | 1.2 MB     00:00     
C5.8-base                                                                                                      3591/3591
C5.8-centosplus                                                                                   | 1.9 kB     00:00     
C5.8-centosplus/primary_db                                                                        |  89 kB     00:00     
C5.8-extras                                                                                       | 2.1 kB     00:00     
C5.8-extras/primary_db                                                                            | 207 kB     00:00     
C5.8-updates                                                                                      | 1.9 kB     00:00     
C5.8-updates/primary_db                                                                           | 1.0 MB     00:00     
Setting up Update Process
No Packages marked <span class="k">for </span>Update
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum <span class="nb">install </span>vim-enhanced <span class="nt">-y</span>
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sh-3.2# wget https://github.com/openssl/openssl/archive/refs/tags/openssl-3.0.5.tar.gz
<span class="nt">--2022-10-20</span> 09:51:09--  https://github.com/openssl/openssl/archive/refs/tags/openssl-3.0.5.tar.gz
Resolving github.com... 192.30.255.113
Connecting to github.com|192.30.255.113|:443... connected.
OpenSSL: error:1407742E:SSL routines:SSL23_GET_SERVER_HELLO:tlsv1 alert protocol version
Unable to establish SSL connection.
sh-3.2# 
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sh-3.2# wget <span class="nt">--secure-protocol</span><span class="o">=</span>TLSv1 https://github.com/openssl/openssl/archive/refs/tags/openssl-3.0.5.tar.gz
<span class="nt">--2022-10-20</span> 09:54:03--  https://github.com/openssl/openssl/archive/refs/tags/openssl-3.0.5.tar.gz
Resolving github.com... 192.30.255.113
Connecting to github.com|192.30.255.113|:443... connected.
OpenSSL: error:1409442E:SSL routines:SSL3_READ_BYTES:tlsv1 alert protocol version
Unable to establish SSL connection.
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># tar -xvjf openssl-3.0.5.tar.gz</span>
<span class="nb">tar</span>: bzip2: Cannot <span class="nb">exec</span>: No such file or directory
<span class="nb">tar</span>: Error is not recoverable: exiting now
<span class="nb">tar</span>: Child returned status 2
<span class="nb">tar</span>: Error <span class="nb">exit </span>delayed from previous errors


<span class="c"># yum install bzip2</span>

<span class="c"># tar -xvjf openssl-3.0.5.tar.gz</span>

bzip2: Compressed file ends unexpectedly<span class="p">;</span>
        perhaps it is corrupted?  <span class="k">*</span>Possible<span class="k">*</span> reason follows.
bzip2: Inappropriate ioctl <span class="k">for </span>device
        Input file <span class="o">=</span> <span class="o">(</span>stdin<span class="o">)</span>, output file <span class="o">=</span> <span class="o">(</span>stdout<span class="o">)</span>

It is possible that the compressed file<span class="o">(</span>s<span class="o">)</span> have become corrupted.
You can use the <span class="nt">-tvv</span> option to <span class="nb">test </span>integrity of such files.

You can use the <span class="sb">`</span>bzip2recover<span class="s1">' program to attempt to recover
data from undamaged sections of corrupted files.

tar: Child returned status 2
tar: Error exit delayed from previous errors
</span></code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ./config --prefix=/usr/local/openssl-3.0.5 --openssldir=/usr/local/openssl-3.0.5</span>
Perl v5.10.0 required--this is only v5.8.8, stopped at /openssl-openssl-3.0.5/Configure line 12.
BEGIN failed--compilation aborted at /openssl-openssl-3.0.5/Configure line 12.
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sh-3.2# getconf GNU_LIBC_VERSION
</code></pre></div></div>

<p>Create docker image from iso image</p>

<p>https://wiki.metacentrum.cz/wiki/Creating_Docker_Image_from_.iso_File</p>

<h3 id="muratayusukecentos58">muratayusuke/centos5.8</h3>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker pull muratayusuke/centos5.8

docker <span class="nb">exec</span> <span class="nt">-it</span> muratayusuke/centos5.8:latest /bin/sh



<span class="c"># head -n 1 /etc/issue</span>
CentOS release 5.8 <span class="o">(</span>Final<span class="o">)</span>
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sh-3.2# wget https://github.com/openssl/openssl/archive/refs/tags/openssl-3.0.5.tar.gz
<span class="nt">--2022-10-26</span> 00:05:29--  https://github.com/openssl/openssl/archive/refs/tags/openssl-3.0.5.tar.gz
Resolving github.com... 192.30.255.112
Connecting to github.com|192.30.255.112|:443... connected.
OpenSSL: error:1407742E:SSL routines:SSL23_GET_SERVER_HELLO:tlsv1 alert protocol version
Unable to establish SSL connection.
sh-3.2# 
sh-3.2# 
sh-3.2# wget http://github.com/openssl/openssl/archive/refs/tags/openssl-3.0.5.tar.gz
<span class="nt">--2022-10-26</span> 00:06:06--  http://github.com/openssl/openssl/archive/refs/tags/openssl-3.0.5.tar.gz
Resolving github.com... 140.82.112.4
Connecting to github.com|140.82.112.4|:80... connected.
HTTP request sent, awaiting response... 301 Moved Permanently
Location: https://github.com/openssl/openssl/archive/refs/tags/openssl-3.0.5.tar.gz <span class="o">[</span>following]
<span class="nt">--2022-10-26</span> 00:06:21--  https://github.com/openssl/openssl/archive/refs/tags/openssl-3.0.5.tar.gz
Connecting to github.com|140.82.112.4|:443... connected.
OpenSSL: error:1407742E:SSL routines:SSL23_GET_SERVER_HELLO:tlsv1 alert protocol version
Unable to establish SSL connection.
</code></pre></div></div>

<h5 id="upgrade-perl-version">upgrade perl version</h5>

<p>I referred to this article https://blog.csdn.net/GUI1259802368/article/details/84935290
but a bit different.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./Configure <span class="nt">-des</span> <span class="nt">-Dprefix</span><span class="o">=</span>/usr/local/perl <span class="nt">-Dusethreads</span> <span class="nt">-Uversiononly</span> <span class="nt">-Dcc</span><span class="o">=</span>gcc
</code></pre></div></div>

<p><a href="./">back</a></p>
:ET